services:
  # === NEW: Go API Gateway ===
  go-gateway:
    build: ./go-gateway
    container_name: go_gateway
    ports:
      - "8080:8080"
    environment:
      - GIN_MODE=release
      - PYTHON_BACKEND=python-backend:9090
      - CPP_AUDIO_ENGINE=cpp-audio:50051
    depends_on:
      - python-backend
      - cpp-audio
    restart: always

  # === Python Backend (FastAPI) ===
  python-backend:
    build: ./Back-end
    container_name: python_backend
    ports:
      - "9090:9090"
    environment:
      - MONGO_URI=mongodb://mongodb:27017/
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
    depends_on:
      - mongodb
      - qdrant
    restart: always

  # === NEW: C++ Audio Engine ===
  cpp-audio:
    build: ./cpp-audio-engine
    container_name: cpp_audio_engine
    ports:
      - "50051:50051"
    restart: always

  # === Databases ===
  mongodb:
    image: mongo:7
    container_name: mongodb_db
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    restart: always

  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant_db
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: always

volumes:
  mongo_data:
  qdrant_data:
