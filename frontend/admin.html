<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>Admin - AI Guide ‡∏ô‡πà‡∏≤‡∏ô</title>
    <link rel="stylesheet" href="assets/styles/main.css">
    <link rel="stylesheet" href="assets/styles/admin.css">
</head>

<body>
    <div class="bg-grid"></div>

    <div class="container" style="align-items: stretch; max-width: 1000px;">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
                <h1 class="text-gradient">Admin Panel</h1>
                <p style="color: var(--text-muted);">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ AI</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <a href="import.html" class="btn btn-submit"
                    style="text-decoration: none; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border: none; display: flex; align-items: center; gap: 5px;">
                    üì• Bulk Import
                </a>
                <a href="dashboard.html" class="btn btn-submit"
                    style="text-decoration: none; background-color: #667eea; border: none; display: flex; align-items: center; gap: 5px;">
                    üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Dashboard)
                </a>

                <a href="/" class="btn btn-cta"
                    style="text-decoration: none; display: flex; align-items: center; gap: 5px;">
                    <i class="fa-solid fa-house"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </a>
            </div>
        </header>

        <div class="form-container">
            <h2><i class="fa-solid fa-database"></i> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <p style="margin-bottom: 1.5rem;">
                ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel/CSV ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </p>

            <a href="import.html" class="btn btn-cta"
                style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px; padding: 1rem 2rem; font-size: 1.1rem;">
                üì• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            </a>
        </div>

        <!-- Google Sheets Sync Section -->
        <div class="form-container"
            style="margin-top: 2rem; background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(16,185,129,0.05)); border: 1px solid rgba(34,197,94,0.3);">
            <h2 style="color: #22c55e;"><i class="fa-solid fa-table"></i> üîó Google Sheets Sync</h2>
            <p style="margin-bottom: 1rem; color: var(--text-light);">
                Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡πà‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </p>

            <!-- Connection Status -->
            <div id="sheets-status"
                style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 1rem;">
                <div id="sheets-connection-status"
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 0.5rem;">
                    <span id="sheets-status-dot"
                        style="width: 12px; height: 12px; border-radius: 50%; background: #ef4444;"></span>
                    <span id="sheets-status-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
                </div>
                <div id="sheets-info" style="font-size: 0.85rem; color: #888; display: none;">
                    <div>üìä Sheet: <span id="sheets-title">-</span></div>
                    <div>üïê Sync ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="sheets-last-sync">-</span></div>
                    <div>‚öôÔ∏è ‡πÇ‡∏´‡∏°‡∏î: <span id="sheets-mode">-</span></div>
                </div>
            </div>

            <!-- Connect Section -->
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="sheets-url-input" placeholder="‡∏ß‡∏≤‡∏á Google Sheets URL ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
                    style="flex: 1; min-width: 300px; padding: 0.75rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                <button id="sheets-connect-btn" class="btn btn-cta" onclick="connectGoogleSheet()"
                    style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #22c55e, #16a34a);">
                    üîå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
            </div>

            <!-- Sync Mode Selection -->
            <div id="sheets-mode-selection" style="margin-top: 1.5rem; display: none;">
                <h3 style="color: var(--text-light); margin-bottom: 1rem;">‚öôÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î Sync</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                    <!-- Polling Mode Card -->
                    <div id="mode-polling-card" onclick="selectSyncMode('polling')"
                        style="padding: 1.25rem; background: rgba(102,126,234,0.1); border: 2px solid rgba(102,126,234,0.3); border-radius: 12px; cursor: pointer; transition: all 0.3s;">
                        <div
                            style="display: flex; align-items: center; gap: 10px; margin-bottom: 0.75rem; flex-wrap: wrap;">
                            <span style="font-size: 1.5rem;">üîÑ</span>
                            <strong style="color: #667eea;">Auto Polling</strong>
                            <span
                                style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
                            <span
                                style="background: #3b82f6; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">‡∏ó‡∏≥‡∏á‡πà‡∏≤‡∏¢</span>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.75rem;">
                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheet <strong>‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</strong> ‡πÅ‡∏•‡∏∞ sync ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </p>
                        <div style="font-size: 0.8rem; color: #888;">
                            ‚úÖ ‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á setup ‡πÄ‡∏û‡∏¥‡πà‡∏°<br>
                            ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÄ‡∏õ‡πá‡∏ô localhost<br>
                            ‚è±Ô∏è ‡∏≠‡∏≤‡∏à‡∏°‡∏µ delay ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏ô‡∏≤‡∏ó‡∏µ
                        </div>
                    </div>

                    <!-- Webhook Mode Card -->
                    <div id="mode-webhook-card" onclick="selectSyncMode('webhook')"
                        style="padding: 1.25rem; background: rgba(251,191,36,0.1); border: 2px solid rgba(251,191,36,0.3); border-radius: 12px; cursor: pointer; transition: all 0.3s;">
                        <div
                            style="display: flex; align-items: center; gap: 10px; margin-bottom: 0.75rem; flex-wrap: wrap;">
                            <span style="font-size: 1.5rem;">‚ö°</span>
                            <strong style="color: #fbbf24;">Webhook (Real-time)</strong>
                            <span
                                style="background: #ef4444; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.65rem;">‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                                ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.75rem;">
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Google Sheet ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏ô DB <strong>‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</strong>
                        </p>
                        <div style="font-size: 0.8rem; color: #888;">
                            ‚ö° Real-time ‡πÑ‡∏°‡πà‡∏°‡∏µ delay<br>
                            ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á deploy ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ngrok<br>
                            ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á setup Google Apps Script
                        </div>
                    </div>
                </div>

                <!-- Mode Instructions -->
                <div id="mode-instructions"
                    style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="margin-top: 1rem; display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="sheets-sync-btn" class="btn" onclick="syncGoogleSheet()" disabled
                    style="padding: 0.75rem 1.5rem; background: rgba(102,126,234,0.3); border: 1px solid rgba(102,126,234,0.5);">
                    üîÑ Sync ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
                <button id="sheets-start-polling-btn" class="btn" onclick="startAutoPolling()" disabled style="display: none;
                    padding: 0.75rem 1.5rem; background: rgba(34,197,94,0.3); border: 1px solid rgba(34,197,94,0.5);">
                    ‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏° Auto Sync
                </button>
                <button id="sheets-stop-polling-btn" class="btn" onclick="stopAutoPolling()" disabled
                    style="display: none;
                    padding: 0.75rem 1.5rem; background: rgba(251,191,36,0.3); border: 1px solid rgba(251,191,36,0.5);">
                    ‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î Auto Sync
                </button>
                <button id="sheets-disconnect-btn" class="btn" onclick="disconnectGoogleSheet()" disabled
                    style="padding: 0.75rem 1.5rem; background: rgba(239,68,68,0.2); border: 1px solid rgba(239,68,68,0.5); color: #ef4444;">
                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
            </div>

            <!-- Sync Result -->
            <div id="sheets-sync-result"
                style="margin-top: 1rem; display: none; padding: 1rem; background: rgba(34,197,94,0.1); border-radius: 8px; border: 1px solid rgba(34,197,94,0.3);">
            </div>
        </div>

        <hr style="border: none; border-top: 2px solid rgba(255,255,255,0.1); margin: 30px 0;">


        <div id="edit-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-button"
                    onclick="document.getElementById('edit-modal').style.display='none'">&times;</span>
                <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
                <div id="edit-form-image-preview-container" style="margin-bottom: 20px; text-align: center;">
                    <p><strong>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong></p>
                    <img id="edit-form-image-preview" src="" alt="Image Preview"
                        style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd; display: none;">
                    <p id="edit-form-no-image" style="color: #888;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                </div>
                <form id="edit-location-form">
                    <input type="hidden" id="edit-form-mongo-id" name="mongo_id">
                    <input type="hidden" id="edit-form-slug" name="slug">

                    Slug (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ): <br>
                    <input type="text" id="display-slug" disabled style="background: #eee;"><br>

                    Title: <br>
                    <input type="text" id="edit-form-title" name="title" required><br>
                    Summary: <br>
                    <textarea id="edit-form-summary" name="summary" rows="5"></textarea><br>
                    Category: <br>
                    <input type="text" id="edit-form-category" name="category" required><br>
                    Topic: <br>
                    <input type="text" id="edit-form-topic" name="topic" required><br>

                    Keywords (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ comma ,): <br>
                    <input type="text" id="edit-form-keywords" name="keywords"
                        placeholder="e.g., ‡∏ß‡∏±‡∏î,‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö‡∏£‡∏±‡∏Å,‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô"><br>

                    Details (JSON Array): <br>
                    <textarea id="edit-form-details" name="details" rows="8"
                        placeholder='[{"heading": "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "content": "..."}]'></textarea><br>
                    <hr style="margin: 20px 0;">
                    <h4>Image Management (Edit)</h4>
                    <p>Image Prefix ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Slug (‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö)</p>

                    Image Prefix (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Slug ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á): <br>
                    <input type="text" id="edit-form-image-prefix" name="image_prefix"
                        placeholder="e.g., wat_phumin_"><br>

                    Upload New Image File (Optional): <br>
                    <input type="file" id="edit-form-image-file" name="image_file" accept="image/*"><br><br>

                    <button type="submit" class="btn btn-submit"
                        style="background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Save
                        Changes</button>
                </form>
            </div>
        </div>

        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
            <h2 style="margin: 0;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <button onclick="openFieldSettings()" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á Fields"
                style="background: rgba(102,126,234,0.3); border: 1px solid rgba(102,126,234,0.5); border-radius: 8px; padding: 8px 12px; cursor: pointer; color: white; display: flex; align-items: center; gap: 5px;">
                ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Fields
            </button>
        </div>

        <div class="table-container">
            <table id="locations-table">
                <thead id="locations-table-head">
                    <!-- Dynamic headers will be rendered by JS -->
                </thead>
                <tbody id="locations-table-body">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <div id="pagination-container" class="pagination-container">
            <!-- Buttons will be rendered here by JS -->
        </div>

        <!-- Field Settings Modal -->
        <div id="field-settings-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close-button" onclick="closeFieldSettings()">&times;</span>
                <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á Fields</h2>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å fields ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á)
                </p>

                <div id="field-checkboxes"
                    style="max-height: 400px; overflow-y: auto; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    <!-- Checkboxes will be rendered by JS -->
                    <p style="color: #888;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î fields...</p>
                </div>

                <div style="margin-top: 1.5rem; display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="resetFieldSettings()" class="btn"
                        style="background: rgba(251,191,36,0.3); border: 1px solid rgba(251,191,36,0.5);">
                        üîÑ Reset ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    </button>
                    <button onclick="applyFieldSettings()" class="btn btn-cta">
                        ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/scripts/config.js"></script>
    <script src="assets/scripts/main.js"></script>
    <script src="assets/scripts/utils.js"></script>
    <script src="assets/scripts/admin.js"></script>
</body>

</html>