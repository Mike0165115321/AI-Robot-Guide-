# ⚙️ เจาะลึกบริการหลังบ้าน (Backend Services Deep Dive)
**Updated:** January 2026

นอกจาก "สมอง" (RAG) แล้ว ระบบยังมี "อวัยวะภายใน" (Core Services) อีกมากมายที่ทำงานอยู่เบื้องหลังใน `Back-end/core/services/` เพื่อให้ระบบทำงานได้ครบวงจร

---

## 1. ระบบข่าวและแจ้งเตือนภัย (News & Alerts System)
หัวใจของการเป็น "Smart Guide" คือการรู้เหตุการณ์ปัจจุบัน ระบบนี้ทำงานอัตโนมัติ 24/7

### 1.1 News Monitor Service
*   **หน้าที่:** กวาดข้อมูลข่าวสารจากแหล่งต่างๆ (RSS Feed, Web Scraping)
*   **Logic:** ใช้ `DocumentProcessor` อ่านเนื้อหาและส่งให้ AI สรุปเป็น "Smart Summary" (เช่น "น้ำท่วมที่อำเภอปัว รถเล็กผ่านไม่ได้")

### 1.2 News Scheduler
*   **หน้าที่:** ตั้งเวลาทำงาน (Cron Job)
*   **Interval:** ตรวจสอบข่าวใหม่ทุกๆ 30 นาที (ปรับได้ใน `config.py`)
*   **Action:** เมื่อเจอข่าวด่วนระดับ `CRITICAL` จะสั่ง `AlertManager` ทันที

### 1.3 Alert Manager
*   **หน้าที่:** กระจายข่าวสารไปยังทุกช่องทาง
*   **Channels:**
    *   **Frontend:** ส่ง WebSocket Event ไปที่หน้าจอ Kiosk ให้ Avatar พูดแจ้งเตือนทันที
    *   **LINE OA:** ส่ง Push Notification แจ้งเตือนผู้ติดตาม

---

## 2. ระบบเชื่อมต่อแพลตฟอร์ม (Platform Integration)

### 2.1 LINE Message Builder
*   **หน้าที่:** แปลงคำตอบจาก AI เป็น "Flex Message" ที่สวยงามสำหรับ LINE
*   **Features:**
    *   สร้างการ์ดสถานที่ท่องเที่ยว (Image, Title, Rating, Map Button)
    *   สร้างเมนูนำทางด่วน
    *   จัดการ Quick Reply options

### 2.2 Google Sheets Service
*   **หน้าที่:** ซิงค์ข้อมูลระหว่าง Database และ Google Sheets
*   **Use Case:** แอดมินสามารถเพิ่ม/แก้ไขข้อมูลสถานที่เที่ยวผ่าน Google Sheets ได้เลย โดยไม่ต้องเข้าแก้ใน Database โดยตรง ระบบจะดูดข้อมูลมาอัปเดตลง MongoDB อัตโนมัติ

---

## 3. บริการยูทิลิตี้ (Utility Services)

### 3.1 Weather & Air Quality Service
*   **API:** OpenWeatherMap & AQICN
*   **Logic:** ดึงข้อมูลสภาพอากาศและ PM2.5 แบบ Real-time ตามพิกัด GPS ของผู้ใช้ หรือสถานที่ที่ถามถึง

### 3.2 Calculator Service
*   **Hybrid Logic:**
    1.  พยายามคำนวณด้วย Python `eval()` (ปลอดภัย) สำหรับโจทย์คณิตศาสตร์ตรงไปตรงมา
    2.  ถ้าเป็นโจทย์ปัญหา (Word Problem) จะส่งให้ AI (Llama 70B) ตีความก่อนแล้วค่อยคำนวณ

---
*เอกสารนี้รวบรวมข้อมูลจาก `Back-end/core/services/` ณ วันที่ 10 Jan 2026*
