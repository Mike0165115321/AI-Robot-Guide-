# แผนปรับปรุง UI: ปุ่ม "คุยกับน้องน่าน" แบบสายรุ้ง 🌈

## เป้าหมาย
เปลี่ยนประสบการณ์การคุยด้วยเสียงให้โดดเด่นและใช้งานง่ายขึ้น โดยสร้างปุ่มสายรุ้งที่สลับระหว่าง **โหมดพิมพ์** กับ **โหมดพูด**

## พฤติกรรมที่ต้องการ

```
┌─────────────────────────────────────────────────────────────┐
│ โหมดพิมพ์ (ปกติ)                                            │
│                                                             │
│  ┌──────────────────────────────────┐  ┌─────────────────┐  │
│  │    พิมพ์คำถาม...                 │  │ 🌈 คุยกับน้องน่าน│  │
│  └──────────────────────────────────┘  └─────────────────┘  │
│                                       (ปุ่มสายรุ้งเด่น)     │
└─────────────────────────────────────────────────────────────┘
                          │ คลิก
                          ▼
┌─────────────────────────────────────────────────────────────┐
│ โหมดพูด (Voice Mode)                                        │
│                                                             │
│       ┌─────────────────────────────────────────────────┐   │
│       │        🎤 กำลังฟัง...  (Pulsing Animation)      │   │
│       │               [หยุดพูด]                         │   │
│       └─────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Proposed Changes

### Component: Input Bar UI

#### [MODIFY] [index.html](file:///home/mikedev/AI%20Robot%20Guide%20%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B8%99%E0%B9%88%E0%B8%B2%E0%B8%99/frontend/index.html)

**เปลี่ยนจาก:**
```html
<div class="input-bar">
    <input type="text" id="query-input" placeholder="พิมพ์คำถาม..." autocomplete="off">
    <button class="btn-mode" id="btn-ai-mode" title="เปลี่ยนโหมด AI">⚡</button>
    <button class="btn-voice" id="btn-voice" title="พูด">🎤</button>
    <button class="btn-send" id="btn-send" title="ส่ง">📤</button>
</div>
```

**เป็น:**
```html
<div class="input-bar">
    <!-- Mode: Text Input (default visible) -->
    <div class="input-mode text-mode" id="text-mode">
        <input type="text" id="query-input" placeholder="พิมพ์คำถาม..." autocomplete="off">
        <button class="btn-mode" id="btn-ai-mode" title="เปลี่ยนโหมด AI">⚡</button>
        <button class="btn-send" id="btn-send" title="ส่ง">📤</button>
    </div>
    
    <!-- Mode: Voice (hidden by default) -->
    <div class="input-mode voice-mode hidden" id="voice-mode">
        <div class="voice-indicator">
            <div class="voice-pulse"></div>
            <span class="voice-status">กำลังฟัง... 👂</span>
        </div>
        <button class="btn-stop-voice" id="btn-stop-voice">หยุดพูด</button>
    </div>
    
    <!-- Rainbow Button (always visible) -->
    <button class="btn-rainbow" id="btn-voice-toggle" title="คุยกับน้องน่าน">
        <span class="rainbow-icon">🎤</span>
        <span class="rainbow-text">คุยกับน้องน่าน</span>
    </button>
</div>
```

---

#### [MODIFY] [base.css](file:///home/mikedev/AI%20Robot%20Guide%20%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B8%99%E0%B9%88%E0%B8%B2%E0%B8%99/frontend/css/base.css) หรือ inline style ใน `index.html`

**เพิ่ม:**
```css
/* Rainbow Button (คุยกับน้องน่าน) */
.btn-rainbow {
    background: linear-gradient(135deg, 
        #ff6b6b, #ffa500, #ffd93d, #6bcf7f, #4ecdc4, #9b5de5, #f15bb5);
    background-size: 300% 300%;
    animation: rainbow-shift 3s ease infinite;
    color: white;
    font-weight: 600;
    padding: 12px 20px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 8px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(155, 93, 229, 0.4);
    transition: transform 0.2s, box-shadow 0.2s;
}

.btn-rainbow:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 30px rgba(155, 93, 229, 0.6);
}

@keyframes rainbow-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Voice Mode Indicator */
.voice-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.voice-pulse {
    width: 24px;
    height: 24px;
    background: #ef4444;
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

.voice-status {
    color: var(--color-text);
    font-size: 1.1rem;
}

.btn-stop-voice {
    background: #374151;
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    border: 1px solid #4b5563;
}

/* Mode Switching */
.input-mode {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    flex: 1;
}

.input-mode.hidden {
    display: none;
}

.text-mode input {
    flex: 1;
}

/* Rainbow button active state (ขณะฟังเสียง) */
.btn-rainbow.active {
    animation: rainbow-shift 0.5s ease infinite;
    box-shadow: 0 6px 30px rgba(239, 68, 68, 0.6);
}
```

---

#### [MODIFY] [app.js](file:///home/mikedev/AI%20Robot%20Guide%20%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B8%99%E0%B9%88%E0%B8%B2%E0%B8%99/frontend/js/app.js)

**แก้ไข `bindEvents()` และ `handleVoice()`:**

1. ลบ event listener ของ `#btn-voice` เดิม
2. เพิ่ม event listener ใหม่สำหรับ `#btn-voice-toggle` (ปุ่มสายรุ้ง)
3. เพิ่ม event listener สำหรับ `#btn-stop-voice`
4. สร้างฟังก์ชัน `toggleVoiceMode()` ที่สลับระหว่าง text-mode กับ voice-mode

**ตัวอย่าง Logic:**
```javascript
function toggleVoiceMode() {
    const textMode = $('#text-mode');
    const voiceMode = $('#voice-mode');
    const rainbowBtn = $('#btn-voice-toggle');
    
    if (state.isVoiceMode) {
        // Switch to Text Mode
        textMode.classList.remove('hidden');
        voiceMode.classList.add('hidden');
        rainbowBtn.classList.remove('active');
        speechService.stopVAD(true);
        state.isVoiceMode = false;
        state.isRecording = false;
    } else {
        // Switch to Voice Mode
        textMode.classList.add('hidden');
        voiceMode.classList.remove('hidden');
        rainbowBtn.classList.add('active');
        startVoiceRecording();
        state.isVoiceMode = true;
    }
}

async function startVoiceRecording() {
    const voiceStatus = $('.voice-status');
    
    const success = await speechService.startVAD({
        onStatusUpdate: (status) => {
            if (voiceStatus) voiceStatus.textContent = status;
        },
        onSpeechEnd: async (audioBlob) => {
            // ประมวลผลเสียง
            voiceStatus.textContent = 'กำลังประมวลผล... 🔄';
            try {
                const response = await chatService.sendAudio(audioBlob, state.sessionId);
                if (response.success) {
                    handleBackendResponse(response.data);
                }
            } finally {
                // กลับไปโหมดพิมพ์หลังประมวลผลเสร็จ
                toggleVoiceMode();
            }
        }
    });
    
    if (!success) {
        toggleVoiceMode(); // กลับไปโหมดพิมพ์ถ้าเปิดไมค์ไม่ได้
    }
}
```

---

## Verification Plan

### Manual Verification
1. **ทดสอบการสลับโหมด:**
   - เปิดหน้า `http://localhost:8014/`
   - ตรวจสอบว่าเห็นกล่องพิมพ์และปุ่มสายรุ้ง "คุยกับน้องน่าน"
   - กดปุ่มสายรุ้ง → กล่องพิมพ์ควรหายไป และแสดง Voice Indicator แทน
   - กด "หยุดพูด" → กลับมาเป็นกล่องพิมพ์

2. **ทดสอบ Voice Recording:**
   - กดปุ่มสายรุ้งเพื่อเข้าโหมดพูด
   - พูดทดสอบ "สถานที่ท่องเที่ยวจังหวัดน่าน"
   - รอระบบประมวลผล (VAD จะตรวจจับ silence)
   - ตรวจว่าได้คำตอบจาก AI และกลับมาโหมดพิมพ์

3. **ทดสอบ Responsive:**
   - ลองย่อหน้าจอให้แคบลง (768px)
   - ตรวจว่าปุ่มสายรุ้งยังแสดงอยู่และใช้งานได้
